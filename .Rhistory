prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE)
)
View(boot_summary)
i <-6
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE)) %>%
summarize(Length = mean(Length),
mean_R.HD = mean(R.HD),
mean_R.HF = mean(R.HF),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever))
View(tmp.dat)
head(all_boot)
# 2. Bootstrap Individual whales -----
n_boots <- 1000 # number of simulations
boot_params_hd <-vector("list", n_boots) # parameters for HD ratio
boot_params_hf <-vector("list", n_boots) # parameters for HF ratio
ss_hd <- vector("list", n_boots) #sum of squares
ss_hf <- vector("list", n_boots)
dat_boot <- vector("list", n_boots) #individual estimates of p_fem
for(i in 1:n_boots){
# each time
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE)) %>%
summarize(Length = mean(Length),
mean_R.HD = mean(R.HD),
mean_R.HF = mean(R.HF),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever))
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = mean_R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = mean_R.HF),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = mean_R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = mean_R.HF))
#save:
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
}
# 2. Bootstrap Individual whales -----
n_boots <- 20 # number of simulations
boot_params_hd <-vector("list", n_boots) # parameters for HD ratio
boot_params_hf <-vector("list", n_boots) # parameters for HF ratio
ss_hd <- vector("list", n_boots) #sum of squares
ss_hf <- vector("list", n_boots)
dat_boot <- vector("list", n_boots) #individual estimates of p_fem
for(i in 1:n_boots){
# each time
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE)) %>%
summarize(Length = mean(Length),
mean_R.HD = mean(R.HD),
mean_R.HF = mean(R.HF),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever))
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = mean_R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = mean_R.HF),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = mean_R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = mean_R.HF))
#save:
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
}
# 3. Get average and CI estimates-----
#~~~a. p_female-----
all_boot <- bind_rows(dat_boot, .id = "bootstrap")
View(all_boot)
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(mean_R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(mean_R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(mean_R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(mean_R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(mean_R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(mean_R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE)
)
View(boot_summary)
i <-1
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE))
tmp.dat
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE))
tmp.dat
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = mean_R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HF),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = R.HF))
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
# 2. Bootstrap Individual whales -----
n_boots <- 20 # number of simulations
boot_params_hd <-vector("list", n_boots) # parameters for HD ratio
boot_params_hf <-vector("list", n_boots) # parameters for HF ratio
ss_hd <- vector("list", n_boots) #sum of squares
ss_hf <- vector("list", n_boots)
dat_boot <- vector("list", n_boots) #individual estimates of p_fem
for(i in 1:n_boots){
# each time
tmp.dat <- dat_HF %>%
group_by(ID) %>%
group_modify(~ slice_sample(.x, n = nrow(.x), replace = TRUE))
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HF),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = R.HF))
#save:
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
}
# 3. Get average and CI estimates-----
#~~~a. p_female-----
all_boot <- bind_rows(dat_boot, .id = "bootstrap")
View(all_boot)
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(mean_R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(mean_R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(mean_R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(mean_R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(mean_R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(mean_R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE)
)
View(all_boot)
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE)
)
View(boot_summary)
ss_hd
ss_hf
boot_params_hd
boot_params_hf
# 4. Visualize -----
#
ggplot(all_boot, aes(x = ID, y = fem_prob_hd))+
geom_boxplot()
ggplot(all_boot, aes(x = ID, y = fem_prob_hF))+
geom_boxplot()
ggplot(all_boot, aes(x = ID, y = fem_prob_hf))+
geom_boxplot()
# 4. Visualize -----
#
ggplot(all_boot, aes(x = Length, y = fem_prob_hd))+
geom_boxplot()
# 4. Visualize -----
#
ggplot(all_boot, aes(x = Length, y = fem_prob_hd, fill = ID))+
geom_boxplot()
ggplot(all_boot, aes(x = Length, y = fem_prob_hf, fill = ID))+
geom_boxplot()
tmp.dat <- dat_HF %>%
group_by(ID) %>%
slice_sample(n = 1)
tmp.dat
for(i in 1:n_boots){
# each time
tmp.dat <- dat_HF %>%
group_by(ID) %>%
slice_sample(n = 1)
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HD),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HF),
chm = 6,
pard0 = c(0.2, 0.2, 0.2, 0.2), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = R.HF))
#save:
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
}
# 3. Get average and CI estimates-----
all_boot <- bind_rows(dat_boot, .id = "bootstrap")
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE)
)
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = Length, y = fem_prob_hd))+
geom_boxplot()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = fem_prob_hd))+
geom_boxplot()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD))+
geom_boxplot()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD))+
geom_scatter()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD))+
geom_point()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point()+
geom
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point()
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hf))+
geom_point()
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point()
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = quantile(fem_prob_hd, 0.025, na.rm = TRUE),
prob_hd_CI_hi = quantile(fem_prob_hd, 0.975, na.rm = TRUE),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = quantile(fem_prob_hf, 0.025, na.rm = TRUE),
prob_hf_CI_hi = quantile(fem_prob_hf, 0.975, na.rm = TRUE),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever)
)
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point()
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever))
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling))
# 4. Visualize -----
#
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckling_ever))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever))
ggplot(boot_summary, aes(x = mean_length, y = mean_fem_prob_hd))+
geom_point()
ggplot(boot_summary, aes(x = mean_length, y = mean_fem_prob_hd))+
geom_point()+
geom_errorbar(aes(ymin = prob_hd_CI_low, ymax = prob_hd_CI_hi))
ggplot(boot_summary, aes(x = mean_length, y = mean_fem_prob_hf))+
geom_point()+
geom_errorbar(aes(ymin = prob_hf_CI_low, ymax = prob_hf_CI_hi))
# 4. Visualize -----
#
boot_summary$CI_width_HD <- boot_summary$prob_hd_CI_hi - boot_summary$prob_hd_CI_hi
boot_summary$CI_width_HF <- boot_summary$prob_hf_CI_hi - boot_summary$prob_hf_CI_hi
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD))
boot_summary$CI_width_HD
boot_summary$prob_hd_CI_hi
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = unname(quantile(fem_prob_hd, 0.025, na.rm = TRUE)),
prob_hd_CI_hi = unname(quantile(fem_prob_hd, 0.975, na.rm = TRUE)),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = unname(quantile(fem_prob_hf, 0.025, na.rm = TRUE)),
prob_hf_CI_hi = unname(quantile(fem_prob_hf, 0.975, na.rm = TRUE)),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever)
)
# 4. Visualize -----
#
boot_summary$CI_width_HD <- boot_summary$prob_hd_CI_hi - boot_summary$prob_hd_CI_hi
boot_summary$CI_width_HD <
)
boot_summary$CI_width_HD
# 4. Visualize -----
#
boot_summary$CI_width_HD <- boot_summary$prob_hd_CI_hi - boot_summary$prob_hd_CI_low
boot_summary$CI_width_HD
# 4. Visualize -----
#
boot_summary$CI_width_HD <- boot_summary$prob_hd_CI_hi - boot_summary$prob_hd_CI_low
boot_summary$CI_width_HF <- boot_summary$prob_hf_CI_hi - boot_summary$prob_hf_CI_low
boot_summary$CI_width_HF
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD+1))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD+1), alpha = 0.7)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF+1))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF+1), alpha = 0.7)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF+1), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD+1), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF), alpha = 0.9)
nish <- read.csv("Data/nishiwaki_parameters.csv")
nish
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HD),
chm = 6,
pard0 = c(nish$Value[3],
nish$Value[1],
nish$Value[4],
nish$Value[2]), weighted = FALSE)
# 2. Bootstrap Individual whales -----
n_boots <- 1000 # number of simulations
boot_params_hd <-vector("list", n_boots) # parameters for HD ratio
boot_params_hf <-vector("list", n_boots) # parameters for HF ratio
ss_hd <- vector("list", n_boots) #sum of squares
ss_hf <- vector("list", n_boots)
dat_boot <- vector("list", n_boots) #individual estimates of p_fem
for(i in 1:n_boots){
# each time
tmp.dat <- dat_HF %>%
group_by(ID) %>%
slice_sample(n = 1)
hd.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HD),
chm = 6,
pard0 = c(nish$Value[3],
nish$Value[1],
nish$Value[4],
nish$Value[2]), weighted = FALSE)
hf.temp <- optim_sex(tmp.dat %>% mutate(Ratio = R.HF),
chm = 6,
pard0 =  c(nish$Value[3],
nish$Value[1],
nish$Value[4],
nish$Value[2]), weighted = FALSE)
tmp.dat$fem_prob_hd <- f_probs(hd.temp$params, data = tmp.dat %>% mutate(Ratio = R.HD))
tmp.dat$fem_prob_hf <- f_probs(hf.temp$params, data = tmp.dat %>% mutate(Ratio = R.HF))
#save:
boot_params_hd[[i]] <- hd.temp$params
boot_params_hf[[i]] <- hf.temp$params
ss_hd[[i]] <-hd.temp$ss
ss_hf[[i]] <-hf.temp$ss
dat_boot[[i]] <- tmp.dat
}
# 3. Get average and CI estimates-----
all_boot <- bind_rows(dat_boot, .id = "bootstrap")
boot_summary<-all_boot %>%
group_by(ID) %>%
summarize(
mean_length = mean(Length, na.rm = TRUE),
length_CI_low = quantile(Length, 0.025, na.rm = TRUE),
length_CI_hi = quantile(Length, 0.975, na.rm = TRUE),
mean_R.HD = mean(R.HD, na.rm = TRUE),
R.HD_CI_low = quantile(R.HD, 0.025, na.rm = TRUE),
R.HD_CI_hi = quantile(R.HD, 0.975, na.rm = TRUE),
mean_R.HF = mean(R.HF, na.rm = TRUE),
R.HF_CI_low = quantile(R.HF, 0.025, na.rm = TRUE),
R.HF_CI_hi = quantile(R.HF, 0.975, na.rm = TRUE),
mean_fem_prob_hd = mean(fem_prob_hd, na.rm = TRUE),
prob_hd_CI_low = unname(quantile(fem_prob_hd, 0.025, na.rm = TRUE)),
prob_hd_CI_hi = unname(quantile(fem_prob_hd, 0.975, na.rm = TRUE)),
mean_fem_prob_hf = mean(fem_prob_hf, na.rm = TRUE),
prob_hf_CI_low = unname(quantile(fem_prob_hf, 0.025, na.rm = TRUE)),
prob_hf_CI_hi = unname(quantile(fem_prob_hf, 0.975, na.rm = TRUE)),
suckled_ever = first(suckled_ever),
suckling_ever = first(suckling_ever)
)
# 4. Visualize -----
#
boot_summary$CI_width_HD <- boot_summary$prob_hd_CI_hi - boot_summary$prob_hd_CI_low
boot_summary$CI_width_HF <- boot_summary$prob_hf_CI_hi - boot_summary$prob_hf_CI_low
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckling_ever, size = CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever, size = CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever, alpha = 1-CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever, alpha = 1-CI_width_HD))
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever, alpha = 1-CI_width_HD), size = 3)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, alpha = 1-CI_width_HF), size = 3)
size
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HD, colour = mean_fem_prob_hd))+
geom_point(aes(shape = suckled_ever, size = CI_width_HD), alpha = 0.9)
ggplot(boot_summary, aes(x = mean_length, y = mean_R.HF, colour = mean_fem_prob_hf))+
geom_point(aes(shape = suckled_ever, size = CI_width_HF), alpha = 0.9)
ss_hd
boot_params_hd
bind_rows(boot_params_hd)
hd.temp$params
